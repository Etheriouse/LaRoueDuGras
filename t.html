<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bouton verrouill√© par date</title>
<style>
  :root{
    --bg:#111;
    --card:#1f1f1f;
    --accent:#4caf50;
    --muted:#bdbdbd;
    --danger:#e53935;
  }

  body{
    background:var(--bg);
    color:#fff;
    font-family:Inter, system-ui, Arial, sans-serif;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:2rem;
  }

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:20px;
    box-shadow:0 6px 24px rgba(0,0,0,0.6);
    width:360px;
  }

  .title{ font-weight:600; margin-bottom:12px; }
  .desc { color:var(--muted); font-size:0.95rem; margin-bottom:18px; }

  .meta { margin-top:14px; font-size:0.9rem; color:var(--muted); display:flex; justify-content:space-between; gap:10px; align-items:center; }

  .countdown { font-variant-numeric:tabular-nums; font-weight:700; color:#fff; }

  .unlocked { color:var(--accent); font-weight:700; }

  .danger { color:var(--danger); }

  /* style du bouton d√©sactiv√© */
  button.action[disabled]{
    opacity:.55;
    cursor:not-allowed;
  }

  /* input demo */
  .demo {
    margin-top:14px; display:flex; gap:8px; align-items:center;
  }
  input[type=datetime-local]{
    background:transparent;
    color:#fff;
    padding:6px 8px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    outline:none;
  }
  small { color:var(--muted); display:block; margin-top:8px; font-size:0.8rem; }
</style>
</head>
<body>

<div class="card" id="card">

</div>

<script>
/**
 * Composant : bouton verrouill√© par date
 * - unlockAt : Date ou string parseable (ISO) indiquant la date de d√©verrouillage
 * - auto-update chaque seconde
 * - lever un √©v√®nement 'unlocked' lorsque le bouton devient actif
 */

// √©l√©ments UI
const actionBtn = document.getElementById('actionBtn');
const lockOverlay = document.getElementById('lockOverlay');
const lockText = document.getElementById('lockText');
const unlockDateText = document.getElementById('unlockDateText');
const countdownText = document.getElementById('countdownText');

let unlockAt = null;
let intervalId = null;

function formatDateLocal(d){
  if(!d) return '‚Äî';
  // format lisible local : "jeu 18 sep 2025 12:34"
  return d.toLocaleString(undefined, {
    weekday: 'short', year:'numeric', month:'short', day:'numeric',
    hour:'2-digit', minute:'2-digit'
  });
}

function msToHMS(ms){
  if(ms <= 0) return {h:0,m:0,s:0};
  const totalSec = Math.floor(ms/1000);
  const h = Math.floor(totalSec/3600);
  const m = Math.floor((totalSec % 3600)/60);
  const s = totalSec % 60;
  return {h,m,s};
}

function renderCountdown(ms){
  const {h,m,s} = msToHMS(ms);
  if(ms <= 0) return '00:00:00';
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

/** configure le unlockAt (Date ou string ISO)
 *  startImmediately = true -> d√©marre l'interval si n√©cessaire
 */
function setUnlockAt(value, startImmediately = true){
  if(!value){ unlockAt = null; stopTicker(); updateUI(); return; }
  const d = (value instanceof Date) ? value : new Date(value);
  if(Number.isNaN(d.getTime())){
    console.warn('Date invalide', value);
    return;
  }
  unlockAt = d;
  unlockDateText.textContent = formatDateLocal(unlockAt);
  if(startImmediately) startTicker();
  updateUI(); // pour appliquer imm√©diatement
}

function startTicker(){
  if(intervalId) return;
  intervalId = setInterval(() => {
    updateUI();
  }, 1000);
  updateUI();
}

function stopTicker(){
  if(intervalId){ clearInterval(intervalId); intervalId = null; }
}

/** update UI en fonction de unlockAt et du temps courant */
function updateUI(){
  const now = new Date();
  if(!unlockAt){
    // si pas de date configur√©e : √©tat d√©verrouill√© par d√©faut
    actionBtn.disabled = false;
    lockOverlay.style.display = 'none';
    unlockDateText.textContent = '‚Äî';
    countdownText.textContent = '‚Äî';
    return;
  }

  const diff = unlockAt - now;
  // si date atteinte ou d√©pass√©e
  if(diff <= 0){
    actionBtn.disabled = false;
    lockOverlay.style.display = 'none';
    countdownText.textContent = '00:00:00';
    // trigger once: dispatch √©v√®nement unlock si n√©cessaire
    if(!actionBtn.dataset.unlocked){
      actionBtn.dataset.unlocked = '1';
      const ev = new CustomEvent('unlocked', { detail: { unlockedAt: now, unlockAt } });
      actionBtn.dispatchEvent(ev);
    }
  } else {
    actionBtn.disabled = true;
    lockOverlay.style.display = 'flex';
    lockText.textContent = 'Verrouill√©';
    countdownText.textContent = renderCountdown(diff);
    actionBtn.dataset.unlocked = '';
  }
}

/* --- Demo interactions --- */
const unlockInput = document.getElementById('unlockInput');
const setBtn = document.getElementById('setBtn');

setBtn.addEventListener('click', () => {
  const val = unlockInput.value;
  if(!val){ alert('Choisis une date/heure valide dans le champ'); return; }
  // val est en format local 'yyyy-mm-ddThh:mm' -> on peut construire une Date directement
  // new Date(val) interpr√®te la valeur comme locale dans la plupart des navigateurs modernes
  setUnlockAt(new Date(val));
});

// Exemple : attacher un handler lorsqu'on est d√©bloqu√©
actionBtn.addEventListener('unlocked', (e) => {
  console.log('D√©bloqu√© !', e.detail);
  // tu peux montrer une notification, envoyer une requ√™te, etc.
});

// Exemple action au clic
actionBtn.addEventListener('click', () => {
  alert('Action autoris√©e ‚Äî bon app√©tit ! üçΩÔ∏è');
});

/* initialisation : par d√©faut verrouill√© 30s √† partir de maintenant (pour demo) */
const demoDate = new Date(Date.now() + 30 * 1000);
setUnlockAt(demoDate);

</script>
</body>
</html>
